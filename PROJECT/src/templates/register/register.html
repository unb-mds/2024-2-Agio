{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="register-container">
    <h1>Register</h1>
    <br/>
    <div class="register-fields">
        {% csrf_token %}  <!-- Django gera automaticamente o token CSRF -->

        <label for="name">Name</label>
        <input type="text" id="name" placeholder="Enter your name" required>

        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email" required>

        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" required>

        <label for="confirm_password">Confirm Password</label>
        <input type="password" id="confirm_password" placeholder="Confirm your password" required>

        <button type="button" onclick="handleRegister()">Register</button>
    </div>
</div>

<script>
    function getCSRFToken() {
        const cookies = document.cookie.split('; ');
        for (const cookie of cookies) {
            const [name, value] = cookie.split('=');
            if (name === 'csrftoken') {
                return value;
            }
        }
        return '';
    }

    function handleRegister() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        const csrfToken = getCSRFToken(); // Obtém o token CSRF dos cookies

        if (!name || !email || !password || !confirmPassword) {
            alert("Por favor, preencha todos os campos.");
            return;
        }

        if (password !== confirmPassword) {
            alert('Passwords do not match!');
            return;
        }

        fetch('/register/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken,  // Adiciona o token CSRF no cabeçalho
            },
            body: JSON.stringify({ name, email, password }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.redirect_url) {
                window.location.href = data.redirect_url;
            } else {
                alert(data.error || 'Falha no registro. Verifique seus dados.');
            }
        })
        .catch(error => console.error('Erro:', error));
    }
</script>
{% endblock content %}
